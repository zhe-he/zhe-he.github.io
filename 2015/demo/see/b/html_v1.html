<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,initial-scale=1.0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="keywords" content="你收到了一封来自宇宙第一男子天团TFBoss的正式邀约！" />
	<title>【正式通知】TFBoss邀请你加入GROUP 2016星·计划</title>
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/animate.css?ver=<?php echo time().mt_rand(111,999);?>">
	<link rel="stylesheet" type="text/css" href="css/index.css?ver=<?php echo time().mt_rand(111,999);?>">
	<script type="text/javascript" src="js/autosize.js"></script>
</head>
<body>
	<!--预加载 s-->
	<div class="preLoading">
		<span class="preCon"></span>
		<span class="preNum">0%</span>
	</div>
	<div class="preMask"></div>
	<!--预加载 e-->

	<audio src="index.mp3" preload loop id="music"></audio>
	<a href="javascript:;" class="music"></a>
	<img class="logo" src="images/logo.png" />
	
	<span class="fontS"></span>
	<span class="handS"></span>
	<article class="main">
		<!--cell cell1 center-->
		<section class="cell cell1 center">
			<h1>原力觉醒！GROUP 2016<br/>将携手NASA带你遨游星际</h1>
			<p><time datetime="2016-01-11">2016-01-12</time><span>集团头条</span></p>
			<div class="con">
				<p>又到了一年一度家人团聚时，今年TFBoss将带你去遨游星际。根据已公布的资料显示，GROUP 2016&美国航天局NASA公布的最新一期“星际探索计划”将于2016年1月22日在广州香格里拉HOTEL正式启动，届时宇宙第一男子天团TFBoss将携手宇宙五大星系927位星干将齐聚香格里拉，用原力星戒唤醒超级宇宙星力量。</p>
				<div class="animate">
					<i></i><i></i><i></i><i></i><i></i><i></i>
					<div class="font"></div>
					<div class="man2"></div>
					<div class="hand"></div>
					<div class="shadow"></div>
					<div class="man"></div>
				</div>
			</div>
		</section>
		<section class="cell cell2">
			<div class="star1"></div>
			<div class="star2"></div>
			<div class="hand"></div>
		</section>
		<section class="cell cell3 hide">
			<div id="contain" class="contain">
				<span class="starc1"></span>
				<span class="starc2"></span>
				
				<div class="ball ball1"></div>
				<div class="ball ball2"></div>
				<div class="ball ball3"></div>
				<div class="ball ball4"></div>
				<div class="ball ball5"></div>
				<div class="ball ball6"></div>
				<div class="ball ball7"></div>
				<div class="ball ball8"></div>
				<div class="ball ball9"></div>

				<aside class="leftImg">
					<span data-index="6" class="addBall addBall7"></span>
					<span data-index="7" class="addBall addBall8"></span>
					<span data-index="8" class="addBall addBall9"></span>
				</aside>
				<aside class="rightImg">
					<span data-index="0" class="addBall addBall1"></span>
					<span data-index="1" class="addBall addBall2"></span>
					<span data-index="2" class="addBall addBall3"></span>
				</aside>
			</div>
		</section>
		<section class="cell cell4 hide">
			<div class="item item1">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 sp0"></div>
					<div class="cc2-1 sp2-1"></div>
					<div class="cc2-3 sp2-3"></div>
					<div class="cc2-2 sp2-2"></div>
				</div>
				<div class="bottom">
					<div class="love"><i></i><i></i></div>
					<div class="con">
						<h3>尚品宅配已收获<span class="count"><?php echo $voteArr['sp'];?></span>个赞</h3>
						<p>原力觉醒！为我的星系点赞</p>
					</div>
				</div>
			</div>

			<div class="item item2">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 ws0"></div>
					<div class="cc2-1 ws2-1"></div>
					<div class="cc2-3 ws2-3"></div>
					<div class="cc2-2 ws2-2"></div>
				</div>
				<div class="bottom">
					<div class="love"><i></i><i></i></div>
					<div class="con">
						<h3>维尚工厂已收获<span class="count"><?php echo $voteArr['wsf'];?></span>个赞</h3>
						<p>原力觉醒！为我的星系点赞</p>
					</div>
				</div>
			</div>
			<div class="item item3">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 wy0"></div>
					<div class="cc2-1 wy2-1"></div>
					<div class="cc2-3 wy2-3"></div>
					<div class="cc2-2 wy2-2"></div>
				</div>
				<div class="bottom">
					<div class="love"><i></i><i></i></div>
					<div class="con">
						<h3>维意定制已收获<span class="count"><?php echo $voteArr['wyd'];?></span>个赞</h3>
						<p>原力觉醒！为我的星系点赞</p>
					</div>
				</div>
			</div>
			<div class="item item4">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 xj0"></div>
					<div class="cc2-1 xj2-1"></div>
					<div class="cc2-3 xj2-3"></div>
					<div class="cc2-2 xj2-2"></div>
				</div>
				<div class="bottom">
					<div class="love"><i></i><i></i></div>
					<div class="con">
						<h3>新居网已收获<span class="count"><?php echo $voteArr['xj'];?></span>个赞</h3>
						<p>原力觉醒！为我的星系点赞</p>
					</div>
				</div>
			</div>
			<div class="item item5">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 yf0"></div>
					<div class="cc2-1 yf2-1"></div>
					<div class="cc2-3 yf2-3"></div>
					<div class="cc2-2 yf2-2"></div>
				</div>
				<div class="bottom">
					<div class="love"><i></i><i></i></div>
					<div class="con">
						<h3>圆方已收获<span class="count"><?php echo $voteArr['yf'];?></span>个赞</h3>
						<p>原力觉醒！为我的星系点赞</p>
					</div>
				</div>
			</div>

			<div class="item item6">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 time0"></div>
					<div class="time2"></div>
				</div>
				<div class="font"></div>
			</div>
			<div class="item item7">
				<div class="back"></div>
				<div class="box">
					<div class="jt2-2"></div>
					<div class="cc0 jt0"></div>
					<div class="jt2-1"></div>
				</div>
				<div class="font"></div>
			</div>
			<div class="item item8">
				<div class="back"></div>
				<div class="box">
					<div class="cc0 tp0"></div>
					<div class="tp2"></div>
				</div>
				<div class="font"></div>
			</div>
			<div class="item item9">
				<div class="share"></div>
				<div class="box">
					<div class="cc0 tip0"></div>
					<div class="tip3"></div>
					<div class="tip2-1"></div>
					<div class="tip2-2"></div>
					<div class="tip2-3-1"></div>
					<div class="tip2-3-2"></div>
				</div>
				<div class="back2"></div>
			</div>
		</section>
	</article>

	<script type="text/javascript" src="js/zepto.min.js"></script>
	<script type="text/javascript" src="js/fastclick.js"></script>
	<script type="text/javascript" src="js/jweixin-1.0.0.js"></script>
	<!--<script type="text/javascript" src="js/index.js"></script>-->
	<script>
	$(function (){
        //alert('版本测试识别号：5,请直接先忽略');
		// 全局变量
		var lastX = 0; 															// 第三屏 上一次的x距离
		var maxWidth = 0;														// 第三屏 最大距离
		var windowWidth = 0; 													// 窗口宽度,后续无缝添加

		var $cell3 = $('.cell3');
		var $cell4 = $('.cell4');
		var $musicBtn = $('.music');
		var $handS = $('.handS');
		var $fontS = $('.fontS');

		// 点赞
		function iLoveYou(){
			var $aLove = $cell4.find('.bottom .love');

			// 传入后台的参数，写中文只是为了方便更改
			//var data = ["尚品宅配","维尚工厂","维意定制","新居网","圆方"];
			var data = ["sp","wsf","wyd","xj","yf"]

			$aLove.each(function (index,ele){
				$(this).on('click', function (){
					var _this = this;
					var con = $(_this).next().find('.count');

                    if (_this.isLove) {
                        alert('您已经点击过一次该星系并投票成功，今天不可重复投票哦！');
                        return false
                    }; // 是否已经点击过一次

					if(_this.isGoing){return false;} // 是否在请求中
					_this.isGoing = true;


					$.ajax({
						url: 	'?act=vote',
						data: 	{
							"index":data[index],
							"openid":"<?php echo $openid;?>",
							"jm":"<?php echo $jm;?>",
							"time":"<?php echo $time;?>"
						},
						dataType: 	'json',
						success: 	function (res){
                            if(typeof(res.flag) != "undefined") {
                                if(res.flag=='1'){
                                	con.text(con.text()-0+1);
                                    _this.isLove = true;
                                }else{
                                	alert(res.msg);
                                }
                            }
							_this.isGoing = false;
                            return;
						},
						error: 		function (a,b){
							_this.isGoing = false;
							alert('网络繁忙，请稍后再试。');
						}
					})
					//_this.isGoing = false; //待删除
					//con.text(con.text()-0+1); //待删除
					// 注释的部分 替换 以上二行

				});
			});
		}

		// 预加载
		function preLoading(){
			var $preload = $('.preLoading');
			var $mask = $('.preMask');
			var $preCon = $('.preLoading .preCon');
			var $preNum = $('.preLoading .preNum');
			var iNow = 0;
			var allImg = ['addf.png','back.png','back2.png','ball-hand.png','ball1.png','ball2.png','ball3.png','ball4.png','ball5.png','ball6.png','ball7.png','ball8.png','ball9.png','bg1.jpg','bg2.jpg','bg3.jpg','bg4.jpg','blankman2.png','font-share.png','font7.png','hand-help.png','hand2.png','hand3.png','head1.png','heart.png','jt0.png','jt2-1.png','jt2-2.png','jt3.png','loading.png','logo.png','music.png','shadow.png','sp0.png','sp2-1.png','sp2-2.png','sp2-3.png','star4.png','star5.png','star6.png','starb1.png','starb2.png','starc1.png','starc2.png','time0.png','time2.png','time3.png','tip0.png','tip2-1-1.png','tip2-1.png','tip2-2-1.png','tip2-2.png','tip3.png','tp0.png','tp2.png','tp3.png','ws0.png','ws2-1.png','ws2-2.png','ws2-3.png','wy0.png','wy2-1.png','wy2-2.png','wy2-3.png','xj0.png','xj2-1.png','xj2-2.png','xj2-3.png','yf0.png','yf2-1.png','yf2-2.png','yf2-3.png'];
		
			for (var i = 0; i < allImg.length; i++) {
				var src = 'images/'+allImg[i];
				fnLoad(src, function (){
					var number = Math.floor(++iNow/allImg.length*100);
					$preNum.text(number+'%');
					$preCon.css('width',6.89*number/100+'rem');
					if (iNow == allImg.length) {
						$mask.remove();
						$preload.remove();
						init();
					};
				});
			};


			function fnLoad(src,callback){
				var img = new Image();
				img.onload = function (){
					this.onload = null;
					callback && callback();
				}
				img.onerror = function (){
					this.onerror = null;
					callback && callback();
				}
				img.src = src;
			}
		}

		// 设置
		function setHeight(){
			var w = $(window).width();
			var h = $(window).height();
			var W = h/818*4662;
			if (w>640) {
				w=640;
			};

			maxWidth = W - w;
			lastX = -maxWidth*0.48275;
			windowWidth = w;
			$('.cell').css({
				"width": 	w + "px",
				"height": h + "px"
			});
			$cell3.find('.contain').css({
				"width": 	W + "px",
				"height": 	h +"px",
				"-webkit-transform": 	"translate3d(" + lastX + "px,0px,0px)",
				"transform": 	"translate3d(" + lastX + "px,0px,0px)"
			});
			$cell3.find('.leftImg').css({
				"width": 	W/3 + "px",
				"height": 	h + "px",
				"left": 	-W/3+1 + "px"
			});
			$cell3.find('.rightImg').css({
				"width": 	W/3 + "px",
				"height": 	h + "px",
				"right": 	-W/3+1 + "px"
			});
		}


		// 第一屏
		function oneScreen(){
			var $cell1 = $('.cell1');
			var $man2 = $cell1.find('.man2');

			$cell1.one('touchstart',function (){
				$(this).addClass('active');
			});

			$man2.on('webkitAnimationEnd animationend', function (){
				$cell1.on('click', function (){
					
					$(this).addClass('stop rotate').on('webkitAnimationEnd animationend', function (){
						$(this).remove();
						twoScreen();
					});
				});

			});

		}
		// 第二屏
		function twoScreen(){
			var $cell2 = $('.cell2');
			$cell2.addClass('center active').on('click', function(){
				$(this).addClass('stop');
				threeScreen();
			})
			$musicBtn.css('display','block');
			document.getElementById('music').play();
		}
		// 第三屏 
		function threeScreen(){
			var $aBall = $cell3.find('.ball');
			var $aAddBall = $cell3.find('.addBall');

			$cell3.removeClass('hide').addClass('center active');

			$handS.addClass('active');
			$fontS.addClass('active');
			$aBall.each(function (index,ele){
				$(ele).on('click', function (){
					$cell3.addClass('stop');

					fourScreen(index);
				});
			});
			$aAddBall.on('click',function (){
				var index = $(this).attr('data-index');
				$cell3.addClass('stop');
				fourScreen(index);
			})



			var isMobile = 'ontouchstart' in window ? true : false;
			var touchStart = isMobile ? 'touchstart' : 'mousedown';
			var touchMove = isMobile ? 'touchmove' : 'mousemove';
			var touchEnd = isMobile ? 'touchend' : 'mouseup';

			var oBox = document.getElementById('contain');
			oBox.addEventListener(touchStart, startFn, false);
			function startFn(ev){
				var touch = ev.targetTouches ? ev.targetTouches[0] : ev;

				var startX = touch.pageX;
				var disX = 0, endX = 0;

				
				function moveFn(ev){
					var touch = ev.targetTouches ? ev.targetTouches[0] : ev;

					disX = touch.pageX - startX + lastX;
					
					if (disX >= windowWidth) {
						disX = windowWidth;
					};
					if (disX <= -(maxWidth+windowWidth)) {
						disX = -(maxWidth+windowWidth);
					};

					oBox.style.WebkitTransform = 'translate3d(' + disX + 'px, 0px, 0px)';
					oBox.style.transform = 'translate3d(' + disX + 'px, 0px, 0px)';
					ev.preventDefault();
				}
				function endFn(ev){
					oBox.removeEventListener(touchMove,moveFn,false);
					oBox.removeEventListener(touchEnd,endFn,false);

					
					if (disX > 0) {
						disX = -maxWidth + disX - windowWidth;
					};
					if (disX < -maxWidth) {
						disX = windowWidth-(-maxWidth - disX);
					};

					if (disX !==0) {
						lastX = disX;
					};

					oBox.style.WebkitTransform = 'translate3d(' + lastX + 'px, 0px, 0px)';
					oBox.style.transform = 'translate3d(' + lastX + 'px, 0px, 0px)';
				}

				oBox.addEventListener(touchMove, moveFn, false);
				oBox.addEventListener(touchEnd, endFn, false);

				ev.preventDefault();
			}
		}

		// 第四屏
		function fourScreen(who){
			var $aItem = $cell4.find('.item');

			$cell4.removeClass('hide').addClass('center');
			$aItem.eq(who).addClass('active');
			$handS.removeClass('active');
			$fontS.removeClass('active');
			fourFn && fourFn();
			
		}

		function fourFn(){
			fourFn = null;
			var $aItem = $cell4.find('.item');
			$cell4.on('click', function (ev){
				var target = ev.target || ev.scrElement;
				
				/*此处做点赞处理*/
				while(target && target.className !== "love"){
					target = target.parentNode;
				}
				if (target && target.className === "love") {
					return false;
				};
				/*此处做点赞处理*/

				/*此处回到上一页*/
				$cell4.addClass('hide').removeClass('center');
				$aItem.removeClass('active');
				$cell3.removeClass('stop');
				$handS.addClass('active');
				$fontS.addClass('active');
				/*此处回到上一页*/
			});
		}

		// 音乐
		function fnMusic(){
			var music = document.getElementById('music');
			$musicBtn.on('click',function (){
				if ($(this).hasClass('close')) {
					$musicBtn.removeClass('close');
					music.play();
				}else{
					$musicBtn.addClass('close');
					music.pause();
				};
			});
		}


		function init(){
			setHeight();
			oneScreen();
			iLoveYou();
			fnMusic();
		}

		// init();   已放入预加载中
		preLoading();
	});
	</script>
	<script>
		// appId,timestamp,nonceStr,signature 请后台添加，谢谢
		var title='【正式通知】TFBoss邀请你加入GROUP 2016星·计划';
		var desc='你收到了一封来自宇宙第一男子天团TFBoss的正式邀约！';
		var shareLink= window.location.href+'?uid='+(Math.random()*1000);
        var sharePic='http://html.spzp.com/spnh_one/images/logo.png';
		wx.config({
			debug: false,
			appId: "<?php echo $signPackage['appId'];?>",
			timestamp: "<?php echo $signPackage['timestamp'];?>",
			nonceStr: "<?php echo $signPackage['nonceStr'];?>",
			signature:"<?php echo $signPackage['signature'];?>",
			jsApiList: [
			'checkJsApi',
			'onMenuShareTimeline',
			'onMenuShareAppMessage',
			'onMenuShareQQ'
			]
		});
		wx.ready(function () {
			wx.checkJsApi({
				jsApiList: [
					'onMenuShareTimeline'
				],
				success: function (res) {
					var reslut=JSON.stringify(res);
					if(res.checkResult.onMenuShareTimeline==false){
						alert('请下载微信最新版，您当前版本将影响您使用本页面分享功能。');	
					}
				}
			});
		
			wx.onMenuShareTimeline({
			  title:title,
			  link: shareLink,
			  imgUrl: sharePic,
			  trigger: function (res) {
				// 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回
				//this.title= window.document.getElementById('shareText').value;
			  },
			  success: function (res) {	
				return;
			  },
			  fail: function (res) {
				alert('分享出错,网络繁忙,请尝试重新打开页面。~~');
			  }
			});
			wx.onMenuShareAppMessage({
				title: title,
				desc: desc,
				link: shareLink,
				imgUrl: sharePic,
				type: 'link', 
				dataUrl: '',
				trigger: function (res) {
					/*this.title= window.document.getElementById('shareText').value;
					this.desc=window.document.getElementById('shareText').value;*/
				},
				success: function () { 
					return;
				}
			});
			wx.onMenuShareQQ({
				title:title,
				desc: desc,
				link: shareLink,
				imgUrl: sharePic,
				trigger: function (res) {
					/*this.title= window.document.getElementById('shareText').value;
					this.desc=window.document.getElementById('shareText').value;*/
				},
				success: function () { 	
					return;
				}
			});
		
	});
    </script>
</body>
</html>